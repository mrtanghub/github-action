name: GitHub Actions Demo
run-name: ${{ github.actor }} is testing out GitHub Actions ðŸš€
on: [push]
jobs:
  Explore-GitHub-Actions:
    name: Explore GitHub Actions
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
      - uses: actions/checkout@v4
#
      - name: create npmrc and env file
        run: |
          echo "${{ secrets.NPMRC_FOR_TEST }}" > .npmrc
          echo "${{ secrets.ENV_FILE_FOR_TEST }}" > .env

      - name: Login to Docker Hub
        uses: docker/login-action@v3 # ç™»å½•åˆ°DockerHub ï¼›è¿™ä¸ªactionä¼šä½¿ç”¨åˆ°usernameå’Œpassword é€šè¿‡withå®šä¹‰è¿™ä¸¤ä¸ªå˜é‡
        with:
          username: ${{ secrets.DOCKER_HUB_USERNAME }}
          password: ${{ secrets.DOCKER_HUB_PASSWORD }}

      - name: Build and push
        uses: docker/build-push-action@v5 # æž„å»ºå¹¶æŽ¨é€åˆ°DockerHub 
        with:
          context: .
          push: true
          tags: ${{ secrets.DOCKER_HUB_USERNAME }}/huashuiai-web-test-docker:latest

      - name: create ssh key
      # ç¬¬2è¡Œå‘½ä»¤ï¼šåœ¨æ ¹ç›®å½•åˆ›å»º.ssh/æ–‡ä»¶å¤¹
      # ç¬¬2è¡Œå‘½ä»¤ï¼šå°†secrets.MY_ID_RSAçš„å€¼å†™å…¥æ ¹ç›®å½•çš„.ssh/id_rsaæ–‡ä»¶ä¸­ï¼Œå¦‚æžœæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶å°†åˆ›å»ºè¿™ä¸ªæ–‡ä»¶
      # ç¬¬3è¡Œå‘½ä»¤ï¼šå°†.ssh/id_rsaæ–‡ä»¶çš„æƒé™è®¾ç½®ä¸º600ï¼Œå³åªæœ‰æ–‡ä»¶æ‰€æœ‰è€…å¯ä»¥è¯»å†™
      # ç¬¬4è¡Œå‘½ä»¤ï¼šå°†secrets.HUAWEI_CLOUD_IPçš„å€¼å†™å…¥æ ¹ç›®å½•çš„.ssh/known_hostsæ–‡ä»¶ä¸­ï¼Œå¦‚æžœæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶å°†åˆ›å»ºè¿™ä¸ªæ–‡ä»¶
      # ç¬¬5è¡Œå‘½ä»¤ï¼šæ‰“å°â€œ---------- create ssh key done ----------â€
        run: |
          mkdir -p ~/.ssh/
          echo "${{secrets.MY_ID_RSA}}" > ~/.ssh/id_rsa 
          chmod 600 ~/.ssh/id_rsa
          ssh-keyscan "${{secrets.HUAWEI_CLOUD_IP}}" >> ~/.ssh/known_hosts
          echo "---------- create ssh key done ----------"
