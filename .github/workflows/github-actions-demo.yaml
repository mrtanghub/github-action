name: GitHub Actions Demo
run-name: ${{ github.actor }} is testing out GitHub Actions 🚀
on: [push]
jobs:
  Explore-GitHub-Actions:
    name: Explore GitHub Actions
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
      - uses: actions/checkout@v4
#
      - name: create npmrc and env file
        run: |
          echo "${{ secrets.NPMRC_FOR_TEST }}" > .npmrc
          echo "${{ secrets.ENV_FILE_FOR_TEST }}" > .env

      - name: Login to Docker Hub
        uses: docker/login-action@v3 # 登录到DockerHub ；这个action会使用到username和password 通过with定义这两个变量
        with:
          username: ${{ secrets.DOCKER_HUB_USERNAME }}
          password: ${{ secrets.DOCKER_HUB_PASSWORD }}

      - name: Build and push
        uses: docker/build-push-action@v5 # 构建并推送到DockerHub 
        with:
          context: .
          push: true
          tags: ${{ secrets.DOCKER_HUB_USERNAME }}/huashuiai-web-test-docker:latest

      - name: create ssh key
      # 第2行命令：在根目录创建.ssh/文件夹
      # 第2行命令：将secrets.MY_ID_RSA的值写入根目录的.ssh/id_rsa文件中，如果没有这个文件将创建这个文件
      # 第3行命令：将.ssh/id_rsa文件的权限设置为600，即只有文件所有者可以读写
      # 第4行命令：将secrets.HUAWEI_CLOUD_IP的值写入根目录的.ssh/known_hosts文件中，如果没有这个文件将创建这个文件
      # 第5行命令：打印“---------- create ssh key done ----------”
        run: |
          mkdir -p ~/.ssh/
          echo "${{secrets.MY_ID_RSA}}" > ~/.ssh/id_rsa 
          chmod 600 ~/.ssh/id_rsa
          ssh-keyscan "${{secrets.HUAWEI_CLOUD_IP}}" >> ~/.ssh/known_hosts
          echo "---------- create ssh key done ----------"
